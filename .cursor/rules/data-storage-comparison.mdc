# æ•°æ®å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”åˆ†æ

## electron-store vs lowdb æŠ€æœ¯é€‰å‹

### ä¸‡å¹´å†åº”ç”¨çš„æ•°æ®éœ€æ±‚åˆ†æ

ä¸‡å¹´å†åº”ç”¨çš„æ•°æ®ç‰¹ç‚¹ï¼š
- **ç”¨æˆ·è®¾ç½®**: ä¸»é¢˜ã€è¯­è¨€ã€åå¥½é…ç½®ï¼ˆé¢‘ç¹è¯»å†™ï¼‰
- **ç”¨æˆ·äº‹ä»¶**: ä¸ªäººæ—¥ç¨‹ã€æé†’äº‹é¡¹ï¼ˆç®€å•CRUDï¼‰
- **ç¼“å­˜æ•°æ®**: å†œå†è®¡ç®—ç»“æœã€èŠ‚æ—¥ä¿¡æ¯ï¼ˆé«˜é¢‘è¯»å–ï¼‰
- **åº”ç”¨çŠ¶æ€**: çª—å£ä½ç½®ã€å¤§å°ç­‰ï¼ˆå®æ—¶ä¿å­˜ï¼‰

**æ•°æ®ç‰¹å¾**ï¼š
- âœ… æ•°æ®é‡ç›¸å¯¹è¾ƒå°ï¼ˆé€šå¸¸ < 10MBï¼‰
- âœ… è¯»å†™é¢‘ç¹ä½†æ“ä½œç®€å•
- âœ… ä¸»è¦æ˜¯é”®å€¼å¯¹å’Œç®€å•æ•°ç»„
- âœ… éœ€è¦å¯é çš„æŒä¹…åŒ–
- âœ… ä¸éœ€è¦å¤æ‚çš„å…³ç³»æŸ¥è¯¢

## è¯¦ç»†å¯¹æ¯”

### 1. API ç®€æ´æ€§

#### electron-store ğŸ“¦
```typescript
import Store from 'electron-store';

// åˆå§‹åŒ–
const store = new Store({
  defaults: {
    theme: 'light',
    language: 'zh-CN',
    events: [],
    windowBounds: { width: 800, height: 600 }
  }
});

// ä½¿ç”¨ - è¶…çº§ç®€å•ï¼
store.set('theme', 'dark');
const theme = store.get('theme');
store.set('events', [...store.get('events'), newEvent]);

// ç›‘å¬å˜åŒ–
store.onDidChange('theme', (newValue, oldValue) => {
  updateTheme(newValue);
});
```

#### lowdb ğŸ—„ï¸
```typescript
import { Low, JSONFile } from 'lowdb';
import path from 'path';

// åˆå§‹åŒ– - éœ€è¦æ‰‹åŠ¨å¤„ç†è·¯å¾„
const file = path.join(app.getPath('userData'), 'data.json');
const adapter = new JSONFile(file);
const db = new Low(adapter);

// ä½¿ç”¨ - éœ€è¦æ›´å¤šæ­¥éª¤
await db.read();
db.data = db.data || { events: [], settings: {} };

db.data.settings.theme = 'dark';
db.data.events.push(newEvent);
await db.write(); // æ‰‹åŠ¨ä¿å­˜

// æŸ¥è¯¢
const darkThemeEvents = db.data.events.filter(event => 
  event.theme === 'dark'
);
```

### 2. Electron é›†æˆåº¦

| ç‰¹æ€§ | electron-store | lowdb |
|------|----------------|-------|
| **è‡ªåŠ¨è·¯å¾„å¤„ç†** | âœ… è‡ªåŠ¨ä½¿ç”¨ `userData` | âŒ éœ€æ‰‹åŠ¨å¤„ç† |
| **æƒé™å¤„ç†** | âœ… è‡ªåŠ¨å¤„ç† | âŒ éœ€æ‰‹åŠ¨å¤„ç† |
| **å¤šå¹³å°å…¼å®¹** | âœ… å†…ç½®æ”¯æŒ | âš ï¸ éœ€é¢å¤–é…ç½® |
| **è¿›ç¨‹é—´é€šä¿¡** | âœ… åŸç”Ÿæ”¯æŒ | âŒ éœ€é¢å¤–å®ç° |

### 3. æ€§èƒ½å¯¹æ¯”

#### electron-store ğŸš€
```typescript
// é’ˆå¯¹å°å‹æ•°æ®ä¼˜åŒ–
// åŒæ­¥æ“ä½œï¼Œæ— éœ€ await
const config = store.get('userConfig'); // ç«‹å³è¿”å›

// å†…ç½®ç¼“å­˜æœºåˆ¶
store.set('theme', 'dark'); // ç«‹å³å†™å…¥
```

#### lowdb ğŸŒ
```typescript
// å¼‚æ­¥æ“ä½œï¼Œéœ€è¦ç­‰å¾…
await db.read(); // æ¯æ¬¡è¯»å–éƒ½éœ€è¦
await db.write(); // æ¯æ¬¡å†™å…¥éƒ½éœ€è¦

// é€‚åˆå¤§å‹æ•°æ®ï¼Œä½†å¯¹å°æ•°æ®æœ‰æ€§èƒ½å¼€é”€
```

### 4. ç±»å‹å®‰å…¨å’ŒéªŒè¯

#### electron-store âœ…
```typescript
interface StoreSchema {
  theme: 'light' | 'dark';
  language: 'zh-CN' | 'en-US';
  events: Event[];
}

const store = new Store<StoreSchema>({
  schema: {
    theme: {
      type: 'string',
      enum: ['light', 'dark'],
      default: 'light'
    }
  }
});

// TypeScript ç±»å‹æ¨æ–­
const theme: 'light' | 'dark' = store.get('theme');
```

#### lowdb âš ï¸
```typescript
// éœ€è¦æ‰‹åŠ¨ç±»å‹å®šä¹‰
interface Database {
  events: Event[];
  settings: Settings;
}

const db = new Low<Database>(adapter);
// ç±»å‹å®‰å…¨éœ€è¦é¢å¤–å·¥ä½œ
```

### 5. åŠŸèƒ½ç‰¹æ€§å¯¹æ¯”

| åŠŸèƒ½ | electron-store | lowdb |
|------|----------------|-------|
| **æ•°æ®éªŒè¯** | âœ… JSON Schema å†…ç½® | âŒ éœ€è¦é¢å¤–åº“ |
| **æ•°æ®åŠ å¯†** | âœ… å†…ç½®æ”¯æŒ | âŒ éœ€è¦é¢å¤–å®ç° |
| **æ•°æ®è¿ç§»** | âœ… ç‰ˆæœ¬ç®¡ç†å†…ç½® | âŒ éœ€è¦æ‰‹åŠ¨å®ç° |
| **ç›‘å¬å˜åŒ–** | âœ… `onDidChange` API | âŒ éœ€è¦é¢å¤–å®ç° |
| **å¤æ‚æŸ¥è¯¢** | âŒ ç®€å•é”®å€¼å¯¹ | âœ… é“¾å¼æŸ¥è¯¢ API |
| **äº‹åŠ¡æ”¯æŒ** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |

### 6. åŒ…å¤§å°å’Œä¾èµ–

```bash
# electron-store
npm list electron-store --depth=0
â””â”€â”€ electron-store@8.1.0  (227KB)

# lowdb 
npm list lowdb --depth=0  
â””â”€â”€ lowdb@7.0.1  (156KB + é¢å¤–ä¾èµ–)
```

### 7. å®é™…ä½¿ç”¨åœºæ™¯å¯¹æ¯”

#### ä¸‡å¹´å†åº”ç”¨çš„å…¸å‹æ“ä½œ

##### ç”¨æˆ·è®¾ç½®ç®¡ç†
```typescript
// electron-store - å®Œç¾åŒ¹é… âœ…
store.set('calendarSettings', {
  showLunar: true,
  weekStartsOn: 1,
  theme: 'dark'
});

// lowdb - è¿‡äºå¤æ‚ âŒ
db.data.settings.calendar = { showLunar: true, ... };
await db.write();
```

##### äº‹ä»¶å­˜å‚¨
```typescript
// electron-store - ç®€å•ç›´æ¥ âœ…
const events = store.get('events', []);
events.push(newEvent);
store.set('events', events);

// lowdb - åŠŸèƒ½å¼ºå¤§ä½†ç¹ç âš ï¸
await db.read();
db.data.events.push(newEvent);
await db.write();
```

##### ç¼“å­˜å†œå†æ•°æ®
```typescript
// electron-store - ç†æƒ³é€‰æ‹© âœ…
store.set(`lunar.${dateKey}`, lunarInfo);
const cached = store.get(`lunar.${dateKey}`);

// lowdb - ä¸å¿…è¦çš„å¤æ‚æ€§ âŒ
db.data.cache = db.data.cache || {};
db.data.cache[dateKey] = lunarInfo;
await db.write();
```

## å†³ç­–çŸ©é˜µ

| è¯„ä¼°ç»´åº¦ | æƒé‡ | electron-store | lowdb | èƒœå‡º |
|----------|------|----------------|-------|------|
| **å¼€å‘æ•ˆç‡** | 25% | 9/10 | 6/10 | electron-store |
| **æ€§èƒ½** | 20% | 9/10 | 7/10 | electron-store |
| **Electroné›†æˆ** | 20% | 10/10 | 5/10 | electron-store |
| **ç»´æŠ¤æˆæœ¬** | 15% | 8/10 | 6/10 | electron-store |
| **åŠŸèƒ½å®Œæ•´æ€§** | 10% | 7/10 | 9/10 | lowdb |
| **æ‰©å±•æ€§** | 10% | 6/10 | 9/10 | lowdb |

**æ€»åˆ†**: electron-store (8.4/10) vs lowdb (6.7/10)

## ä½•æ—¶è€ƒè™‘åˆ‡æ¢åˆ° lowdb

å¦‚æœä¸‡å¹´å†åº”ç”¨æœªæ¥éœ€è¦ï¼š

### å¤æ‚æŸ¥è¯¢éœ€æ±‚ ğŸ”
```typescript
// æŸ¥æ‰¾ç‰¹å®šæ—¶é—´èŒƒå›´çš„äº‹ä»¶
const events = db.data.events
  .filter(event => event.date >= startDate && event.date <= endDate)
  .sortBy('date')
  .value();

// å¤æ‚çš„æ•°æ®åˆ†æ
const stats = db.data.events
  .groupBy('category')
  .mapValues(events => events.length)
  .value();
```

### å¤§é‡å†å²æ•°æ® ğŸ“Š
- å­˜å‚¨å¤šå¹´çš„äº‹ä»¶å†å²
- æ•°æ®é‡è¶…è¿‡ 50MB
- éœ€è¦åˆ†é¡µæŸ¥è¯¢

### æ•°æ®å…³ç³»ç®¡ç† ğŸ”—
```typescript
// äº‹ä»¶ä¹‹é—´çš„å…³è”
const relatedEvents = db.data.events
  .filter(event => event.tags.some(tag => 
    targetEvent.tags.includes(tag)
  ))
  .value();
```

## å½“å‰é€‰æ‹©çš„ä¼˜åŠ¿æ€»ç»“

å¯¹äºä¸‡å¹´å†åº”ç”¨ï¼Œé€‰æ‹© **electron-store** çš„ç†ç”±ï¼š

### âœ… å®Œç¾åŒ¹é…éœ€æ±‚
- è®¾ç½®ç®¡ç†ç®€å•é«˜æ•ˆ
- äº‹ä»¶CRUDæ“ä½œç›´è§‚
- ç¼“å­˜æ•°æ®è®¿é—®å¿«é€Ÿ

### âœ… å¼€å‘ä½“éªŒä¼˜ç§€
- APIç®€æ´æ˜“æ‡‚
- TypeScript æ”¯æŒå®Œå–„
- é”™è¯¯å¤„ç†å‹å¥½

### âœ… æ€§èƒ½è¡¨ç°ä¼˜å¼‚
- åŒæ­¥æ“ä½œï¼Œå“åº”è¿…é€Ÿ
- å†…å­˜å ç”¨å°
- å¯åŠ¨é€Ÿåº¦å¿«

### âœ… ç»´æŠ¤æˆæœ¬ä½
- ä»£ç é‡å°‘
- ä¾èµ–ç®€å•
- å‡çº§å®¹æ˜“

## è¿ç§»ç­–ç•¥ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœæœªæ¥éœ€è¦åˆ‡æ¢åˆ° lowdbï¼š

### 1. æ•°æ®å¯¼å‡º
```typescript
// ä» electron-store å¯¼å‡º
const data = {
  settings: store.get('settings'),
  events: store.get('events'),
  cache: store.get('cache')
};
```

### 2. æ•°æ®å¯¼å…¥
```typescript
// å¯¼å…¥åˆ° lowdb
db.data = data;
await db.write();
```

### 3. API é€‚é…å±‚
```typescript
// åˆ›å»ºå…¼å®¹å±‚
class DataManager {
  async get(key: string) {
    return this.useLowDB ? 
      db.data[key] : 
      store.get(key);
  }
}
```

## ç»“è®º

**electron-store æ˜¯ä¸‡å¹´å†åº”ç”¨çš„æœ€ä½³é€‰æ‹©**ï¼Œå› ä¸ºå®ƒï¼š
- å®Œç¾åŒ¹é…åº”ç”¨çš„æ•°æ®éœ€æ±‚
- æä¾›å“è¶Šçš„å¼€å‘ä½“éªŒ
- å…·æœ‰ä¼˜å¼‚çš„æ€§èƒ½è¡¨ç°
- ç»´æŠ¤æˆæœ¬ä½

åªæœ‰å½“åº”ç”¨å‘å±•åˆ°éœ€è¦å¤æ‚æŸ¥è¯¢å’Œå¤§é‡æ•°æ®å¤„ç†æ—¶ï¼Œæ‰è€ƒè™‘è¿ç§»åˆ° lowdb æˆ–å…¶ä»–æ–¹æ¡ˆã€‚