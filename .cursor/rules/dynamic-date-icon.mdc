# åŠ¨æ€æ—¥æœŸå›¾æ ‡å¼€å‘è§„èŒƒ

## æ¦‚è¿°

æœ¬æ–‡æ¡£è§„èŒƒäº†åŠ¨æ€æ—¥æœŸèœå•æ å›¾æ ‡çš„å®ç°æ ‡å‡†ï¼Œè¯¥åŠŸèƒ½å¯ä»¥åœ¨èœå•æ /ç³»ç»Ÿæ‰˜ç›˜æ˜¾ç¤ºå½“å‰æ—¥æœŸæ•°å­—ã€‚

## è®¾è®¡åŸåˆ™

### 1. è§†è§‰ä¸€è‡´æ€§

- **è·¨å¹³å°ç»Ÿä¸€**: ä¸åŒæ“ä½œç³»ç»Ÿä¿æŒç›¸åŒçš„è§†è§‰é£æ ¼
- **æ¸…æ™°åº¦ä¼˜å…ˆ**: åƒç´ çº§ç²¾ç¡®çš„æ•°å­—æ˜¾ç¤º
- **ç®€æ´è®¾è®¡**: ä¸“æ³¨äºæ—¥æœŸæ˜¾ç¤ºï¼Œé¿å…è¿‡åº¦è£…é¥°
- **é€‚é…ç³»ç»Ÿ**: ç¬¦åˆå„å¹³å°çš„å›¾æ ‡è®¾è®¡è§„èŒƒ

### 2. åŠŸèƒ½ç‰¹æ€§

- **å®æ—¶æ›´æ–°**: è‡ªåŠ¨æ£€æµ‹æ—¥æœŸå˜åŒ–å¹¶æ›´æ–°å›¾æ ‡
- **æ™ºèƒ½ç¼“å­˜**: é¿å…é‡å¤ç”Ÿæˆç›¸åŒæ—¥æœŸçš„å›¾æ ‡
- **é™çº§æ–¹æ¡ˆ**: å¤šå±‚é™çº§ç¡®ä¿å›¾æ ‡æ­£å¸¸æ˜¾ç¤º
- **æ€§èƒ½ä¼˜åŒ–**: é«˜æ•ˆçš„åƒç´ ç»˜åˆ¶ç®—æ³•

## æŠ€æœ¯å®ç°

### 1. å›¾æ ‡ç”Ÿæˆç®—æ³•

```typescript
// ä¸»è¦å‡½æ•°æ¥å£
export function createDateMenuBarIcon(
  platform: string = process.platform, 
  date?: Date
): NativeImage

// å¹³å°ç‰¹å®šå°ºå¯¸
const size = platform === 'darwin' ? 18 : 16
```

### 2. åƒç´ å­—ä½“ç³»ç»Ÿ

#### æ•°å­—å­—ä½“è®¾è®¡ (5x7åƒç´ )
```typescript
const digitPatterns = {
  '0': [
    '01110',
    '10001', 
    '10001',
    '10001',
    '10001',
    '10001',
    '01110'
  ],
  // ... å…¶ä»–æ•°å­—
}
```

#### å¸ƒå±€ç®—æ³•
- **å•æ•°å­—**: å±…ä¸­æ˜¾ç¤º (1-9)
- **åŒæ•°å­—**: å¹¶æ’æ˜¾ç¤ºï¼Œ1åƒç´ é—´è· (10-31)
- **ä½ç½®è®¡ç®—**: åŠ¨æ€å±…ä¸­ç®—æ³•é€‚é…ä¸åŒå›¾æ ‡å°ºå¯¸

### 3. å¹³å°é€‚é…

| å¹³å° | å°ºå¯¸ | ç‰¹æ®Šå¤„ç† |
|------|------|----------|
| **macOS** | 18x18px | èœå•æ ä¼˜åŒ–ï¼Œæ”¯æŒæ˜æš—ä¸»é¢˜ |
| **Windows** | 16x16px | ç³»ç»Ÿæ‰˜ç›˜æ ‡å‡†å°ºå¯¸ |
| **Linux** | 16x16px | æ¡Œé¢ç¯å¢ƒå…¼å®¹æ€§ |

### 4. è‡ªåŠ¨æ›´æ–°æœºåˆ¶

```typescript
// å®šæ—¶æ£€æŸ¥ (æ¯å°æ—¶)
setInterval(() => {
  if (lastIconUpdateDate && shouldUpdateIcon(lastIconUpdateDate)) {
    updateTrayIcon()
  }
}, 60 * 60 * 1000)

// æ—¥æœŸå˜åŒ–æ£€æµ‹
export function shouldUpdateIcon(lastUpdateDate: Date): boolean {
  const now = new Date()
  return (
    lastUpdateDate.getDate() !== now.getDate() ||
    lastUpdateDate.getMonth() !== now.getMonth() ||
    lastUpdateDate.getFullYear() !== now.getFullYear()
  )
}
```

## å›¾æ ‡ç»˜åˆ¶æµç¨‹

### 1. ç”»å¸ƒåˆå§‹åŒ–
```typescript
// åˆ›å»ºRGBAç”»å¸ƒ
const data = new Uint8Array(size * size * 4)

// é€æ˜èƒŒæ™¯å¡«å……
for (let i = 0; i < data.length; i += 4) {
  data[i] = 0     // R
  data[i + 1] = 0 // G  
  data[i + 2] = 0 // B
  data[i + 3] = 0 // A (é€æ˜)
}
```

### 2. èƒŒæ™¯ç»˜åˆ¶
- **åœ†è§’çŸ©å½¢**: æ¨¡æ‹Ÿæ—¥å†å¤–è§‚
- **è£…è®¢å­”**: é¡¶éƒ¨ä¸¤ä¸ªå°åœ†ç‚¹
- **é¢œè‰²æ–¹æ¡ˆ**: ç°è‰²èƒŒæ™¯ + é»‘è‰²æ–‡å­—

### 3. æ•°å­—æ¸²æŸ“
- **è·å–æ—¥æœŸ**: `new Date().getDate()`
- **é€‰æ‹©å­—ä½“**: ä»é¢„å®šä¹‰åƒç´ å­—ä½“ä¸­é€‰æ‹©
- **ä½ç½®è®¡ç®—**: æ ¹æ®æ•°å­—ä¸ªæ•°åŠ¨æ€å±…ä¸­
- **åƒç´ ç»˜åˆ¶**: é€åƒç´ ç»˜åˆ¶æ•°å­—å›¾æ¡ˆ

### 4. å›¾åƒç”Ÿæˆ
```typescript
// ä»åƒç´ æ•°æ®åˆ›å»ºå›¾åƒ
const image = nativeImage.createFromBuffer(Buffer.from(canvas))

// éªŒè¯å’Œé™çº§
if (image.isEmpty()) {
  return createFallbackIcon(size, dayOfMonth)
}
```

## é™çº§æ–¹æ¡ˆ

### 1. ä¸‰å±‚é™çº§ç­–ç•¥

1. **ä¸»æ–¹æ¡ˆ**: å®Œæ•´çš„åƒç´ ç»˜åˆ¶å›¾æ ‡
2. **é™çº§æ–¹æ¡ˆ1**: ç®€åŒ–çš„èƒŒæ™¯+æ–‡å­—å›¾æ ‡
3. **æœ€ç»ˆé™çº§**: ç©ºå›¾æ ‡ï¼ˆç³»ç»Ÿé»˜è®¤ï¼‰

### 2. é”™è¯¯å¤„ç†

```typescript
try {
  const image = nativeImage.createFromBuffer(Buffer.from(canvas))
  return image
} catch (error) {
  console.error('âŒ åˆ›å»ºæ—¥æœŸèœå•æ å›¾æ ‡å¤±è´¥:', error)
  return createFallbackIcon(size, dayOfMonth)
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜æœºåˆ¶
- **æ—¥æœŸç¼“å­˜**: åŒä¸€æ—¥æœŸåªç”Ÿæˆä¸€æ¬¡å›¾æ ‡
- **å®šæ—¶æ¸…ç†**: é¿å…å†…å­˜æ³„æ¼
- **æŒ‰éœ€ç”Ÿæˆ**: ä»…åœ¨éœ€è¦æ—¶åˆ›å»ºå›¾æ ‡

### 2. ç®—æ³•ä¼˜åŒ–
- **å¿«é€Ÿåƒç´ æ“ä½œ**: ç›´æ¥æ“ä½œUint8Array
- **ç®€åŒ–è®¡ç®—**: ä¼˜åŒ–æ•°å­¦è¿ç®—
- **å†…å­˜ç®¡ç†**: åŠæ—¶é‡Šæ”¾ä¸´æ—¶æ•°æ®

### 3. è°ƒè¯•ä¿¡æ¯
```typescript
console.log(`ğŸ“… åˆ›å»ºæ—¥æœŸå›¾æ ‡: ${dayOfMonth} (${size}x${size}px)`)
console.log('âœ… å›¾æ ‡å·²è°ƒæ•´ä¸º 18x18 åƒç´ ')
console.log('â° å›¾æ ‡æ›´æ–°å®šæ—¶å™¨å·²è®¾ç½®')
```

## é›†æˆæŒ‡å—

### 1. åŸºæœ¬ä½¿ç”¨
```typescript
// åˆ›å»ºå½“å‰æ—¥æœŸå›¾æ ‡
const icon = createDateMenuBarIcon()

// åˆ›å»ºæŒ‡å®šæ—¥æœŸå›¾æ ‡  
const customIcon = createDateMenuBarIcon('darwin', new Date('2024-12-25'))

// æ£€æŸ¥æ›´æ–°éœ€æ±‚
if (shouldUpdateIcon(lastUpdate)) {
  updateTrayIcon()
}
```

### 2. æ‰˜ç›˜é›†æˆ
```typescript
// åœ¨æ‰˜ç›˜åˆ›å»ºæ—¶ä½¿ç”¨
const iconImage = createDateMenuBarIcon(process.platform)
tray = new Tray(iconImage)

// è®¾ç½®è‡ªåŠ¨æ›´æ–°
setupIconUpdateTimer()
```

### 3. æ‰‹åŠ¨åˆ·æ–°
```typescript
// æä¾›ç»™ç”¨æˆ·çš„åˆ·æ–°åŠŸèƒ½
export function refreshTrayIcon(): void {
  updateTrayIcon()
}
```

## æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•
- [ ] æ•°å­—å­—ä½“æ¸²æŸ“æµ‹è¯•
- [ ] æ—¥æœŸå˜åŒ–æ£€æµ‹æµ‹è¯•
- [ ] å¹³å°é€‚é…æµ‹è¯•
- [ ] é™çº§æ–¹æ¡ˆæµ‹è¯•

### 2. é›†æˆæµ‹è¯•
- [ ] æ‰˜ç›˜å›¾æ ‡æ˜¾ç¤ºæµ‹è¯•
- [ ] è‡ªåŠ¨æ›´æ–°åŠŸèƒ½æµ‹è¯•
- [ ] è·¨å¹³å°å…¼å®¹æ€§æµ‹è¯•
- [ ] æ€§èƒ½å‹åŠ›æµ‹è¯•

### 3. ç”¨æˆ·æµ‹è¯•
- [ ] å›¾æ ‡æ¸…æ™°åº¦è¯„ä¼°
- [ ] ä¸åŒåˆ†è¾¨ç‡æ˜¾ç¤ºæµ‹è¯•
- [ ] é•¿æœŸè¿è¡Œç¨³å®šæ€§æµ‹è¯•

## æœ€ä½³å®è·µ

### 1. å¼€å‘å»ºè®®
- ä¼˜å…ˆè€ƒè™‘æ¸…æ™°åº¦å’Œå¯è¯»æ€§
- ä¿æŒè·¨å¹³å°ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ
- å®ç°å¥å£®çš„é”™è¯¯å¤„ç†
- æä¾›è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

### 2. ç»´æŠ¤å»ºè®®
- å®šæœŸæ£€æŸ¥å¹³å°å…¼å®¹æ€§
- ç›‘æ§æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨
- æ”¶é›†ç”¨æˆ·åé¦ˆè¿›è¡Œä¼˜åŒ–
- ä¿æŒæ–‡æ¡£åŒæ­¥æ›´æ–°

### 3. æ‰©å±•æ€§è€ƒè™‘
- æ”¯æŒè‡ªå®šä¹‰æ—¥æœŸæ ¼å¼
- æ”¯æŒå¤šè¯­è¨€æ•°å­—æ˜¾ç¤º
- æ”¯æŒä¸»é¢˜é¢œè‰²è‡ªå®šä¹‰
- æ”¯æŒåŠ¨ç”»æ•ˆæœ

## æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜
- **å›¾æ ‡ä¸æ˜¾ç¤º**: æ£€æŸ¥å¹³å°æ”¯æŒå’Œæƒé™
- **å›¾æ ‡æ¨¡ç³Š**: éªŒè¯åƒç´ å¯¹é½å’Œå°ºå¯¸
- **æ›´æ–°å¤±è´¥**: æ£€æŸ¥å®šæ—¶å™¨å’Œæ—¥æœŸæ£€æµ‹
- **å†…å­˜æ³„æ¼**: æ£€æŸ¥ç¼“å­˜æ¸…ç†æœºåˆ¶

### 2. è°ƒè¯•å·¥å…·
```typescript
// å¼€å¯è¯¦ç»†æ—¥å¿—
console.log(`ğŸ“… åˆ›å»ºæ—¥æœŸå›¾æ ‡: ${dayOfMonth}`)
console.log(`ğŸ“‚ å›¾æ ‡å°ºå¯¸: ${size}x${size}px`)
console.log(`â° ä¸‹æ¬¡æ£€æŸ¥æ—¶é—´: ${nextCheckTime}`)
```

### 3. æ€§èƒ½ç›‘æ§
- å›¾æ ‡ç”Ÿæˆè€—æ—¶ç»Ÿè®¡
- å†…å­˜ä½¿ç”¨æƒ…å†µç›‘æ§
- æ›´æ–°é¢‘ç‡ç»Ÿè®¡
- é”™è¯¯ç‡ç›‘æ§

## ç›¸å…³èµ„æº

- [Electron NativeImage API](https://www.electronjs.org/docs/api/native-image)
- [åƒç´ å­—ä½“è®¾è®¡æŒ‡å—](https://en.wikipedia.org/wiki/Pixel_art)
- [è·¨å¹³å°å›¾æ ‡è®¾è®¡è§„èŒƒ](https://developer.apple.com/design/human-interface-guidelines/)
- [ç³»ç»Ÿæ‰˜ç›˜æœ€ä½³å®è·µ](https://docs.microsoft.com/en-us/windows/apps/design/shell/tiles-and-notifications/)